<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🌙 Nightmarket Admin - Quản Lý Dịch Vụ Premium</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #533483 75%, #e94560 100%);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 40% 80%, rgba(120, 219, 255, 0.3) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 30px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.3);
        }

        .sidebar h2 {
            margin-bottom: 40px;
            text-align: center;
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 50%, #45b7d1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-menu li {
            margin-bottom: 10px;
        }

        .nav-menu a {
            display: block;
            padding: 15px 20px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            border-radius: 12px;
            transition: all 0.3s ease;
            margin-bottom: 8px;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .nav-menu a::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        }

        .nav-menu a:hover,
        .nav-menu a.active {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(8px);
            color: #fff;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 40px;
        }

        .header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 30px 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        }

        .header h1 {
            color: #fff;
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 50%, #45b7d1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .stat-card .icon {
            font-size: 40px;
            margin-bottom: 15px;
        }

        .stat-card .number {
            font-size: 36px;
            font-weight: 800;
            background: linear-gradient(135deg, #4ecdc4 0%, #45b7d1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .stat-card .label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 16px;
            font-weight: 500;
        }

        .content-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            padding: 40px;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
        }

        .content-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .section-header h2 {
            color: #fff;
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #ff6b6b 0%, #4ecdc4 50%, #45b7d1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4ecdc4 0%, #45b7d1 100%);
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(78, 205, 196, 0.5);
            background: linear-gradient(135deg, #45b7d1 0%, #4ecdc4 100%);
        }

        .btn-success {
            background: #4CAF50;
            color: white;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-warning {
            background: #ff9800;
            color: white;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 15px;
            overflow: hidden;
        }

        .table th,
        .table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .table th {
            background: rgba(255, 255, 255, 0.05);
            font-weight: 600;
            color: #fff;
            font-size: 14px;
        }

        .table td {
            color: rgba(255, 255, 255, 0.8);
        }

        .table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #fff;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: rgba(78, 205, 196, 0.5);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin: 5% auto;
            padding: 40px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close {
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.6);
            transition: all 0.3s ease;
        }

        .close:hover {
            color: #fff;
            transform: scale(1.1);
        }

        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(78, 205, 196, 0.3);
            }
            50% {
                box-shadow: 0 0 30px rgba(78, 205, 196, 0.5);
            }
        }

        .content-section {
            animation: slideIn 0.6s ease-out;
        }

        .stat-card:hover {
            animation: glow 2s ease-in-out infinite;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: relative;
                height: auto;
            }

            .main-content {
                margin-left: 0;
                padding: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <h2>🌙 Nightmarket</h2>
            <ul class="nav-menu">
                <li><a href="#dashboard" class="active" onclick="showSection('dashboard')">📊 Dashboard</a></li>
                <li><a href="#categories" onclick="showSection('categories')">📁 Danh Mục</a></li>
                <li><a href="#products" onclick="showSection('products')">📦 Sản Phẩm</a></li>
                <li><a href="#orders" onclick="showSection('orders')">🛒 Đơn Hàng</a></li>
                <li><a href="#settings" onclick="showSection('settings')">⚙️ Cài Đặt</a></li>
            </ul>
    </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Section -->
            <div id="dashboard-section" class="content-section">
                <div class="header">
                    <h1>🌙 Nightmarket Admin</h1>
                    <p style="color: rgba(255, 255, 255, 0.7); margin-top: 10px; font-size: 16px;">Quản lý dịch vụ premium với giao diện hiện đại</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="icon">📦</div>
                        <div class="number" id="total-products">0</div>
                        <div class="label">Tổng Sản Phẩm</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon">📁</div>
                        <div class="number" id="total-categories">0</div>
                        <div class="label">Danh Mục</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon">🛒</div>
                        <div class="number" id="total-orders">0</div>
                        <div class="label">Đơn Hàng</div>
                    </div>
                    <div class="stat-card">
                        <div class="icon">💰</div>
                        <div class="number" id="total-revenue">0₫</div>
                        <div class="label">Doanh Thu</div>
                    </div>
                </div>
                    </div>

            <!-- Categories Section -->
            <div id="categories-section" class="content-section" style="display: none;">
                <div class="section-header">
                    <h2>📁 Quản Lý Danh Mục</h2>
                    <button class="btn btn-primary" onclick="openCategoryModal()">➕ Thêm Danh Mục</button>
                </div>
                <table class="table">
                            <thead>
                                <tr>
                            <th>ID</th>
                            <th>Tên Danh Mục</th>
                            <th>Mô Tả</th>
                            <th>Số Sản Phẩm</th>
                                    <th>Thao Tác</th>
                                </tr>
                            </thead>
                    <tbody id="categories-table">
                        <!-- Categories will be loaded here -->
                            </tbody>
                        </table>
            </div>

            <!-- Products Section -->
            <div id="products-section" class="content-section" style="display: none;">
                <div class="section-header">
                    <h2>📦 Quản Lý Sản Phẩm</h2>
                    <button class="btn btn-primary" onclick="openProductModal()">➕ Thêm Sản Phẩm</button>
                    </div>
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Tên Sản Phẩm</th>
                            <th>Danh Mục</th>
                            <th>Giá</th>
                            <th>Tồn Kho</th>
                            <th>Trạng Thái</th>
                            <th>Thao Tác</th>
                        </tr>
                    </thead>
                    <tbody id="products-table">
                        <!-- Products will be loaded here -->
                    </tbody>
                </table>
                </div>

            <!-- Orders Section -->
            <div id="orders-section" class="content-section" style="display: none;">
                <div class="section-header">
                    <h2>🛒 Quản Lý Đơn Hàng</h2>
                        </div>
                <table class="table">
                            <thead>
                                <tr>
                            <th>Mã Đơn</th>
                            <th>Khách Hàng</th>
                            <th>Sản Phẩm</th>
                            <th>Tổng Tiền</th>
                                    <th>Trạng Thái</th>
                                    <th>Ngày Tạo</th>
                                    <th>Thao Tác</th>
                                </tr>
                            </thead>
                    <tbody id="orders-table">
                        <!-- Orders will be loaded here -->
                            </tbody>
                        </table>
                    </div>

            <!-- Settings Section -->
            <div id="settings-section" class="content-section" style="display: none;">
                <div class="section-header">
                    <h2>⚙️ Cài Đặt Hệ Thống</h2>
                </div>
                <div class="form-group">
                    <label>Tên Website:</label>
                    <input type="text" id="site-name" placeholder="Tên website">
            </div>
                        <div class="form-group">
                    <label>Mô Tả Website:</label>
                    <textarea id="site-description" placeholder="Mô tả website"></textarea>
                        </div>
                        <div class="form-group">
                    <label>Email Liên Hệ:</label>
                    <input type="email" id="contact-email" placeholder="admin@andev.site">
                        </div>
                        <div class="form-group">
                    <label>Số Điện Thoại:</label>
                    <input type="tel" id="contact-phone" placeholder="0123456789">
                </div>
                <button class="btn btn-primary" onclick="saveSettings()">💾 Lưu Cài Đặt</button>
            </div>
        </div>
                        </div>
                        
    <!-- Category Modal -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📁 Thêm/Sửa Danh Mục</h3>
                <span class="close" onclick="closeCategoryModal()">&times;</span>
            </div>
            <form id="categoryForm">
                        <div class="form-group">
                    <label>Tên Danh Mục:</label>
                    <input type="text" id="category-name" required>
                        </div>
                        <div class="form-group">
                    <label>Mô Tả:</label>
                    <textarea id="category-description"></textarea>
                        </div>
                        <div class="form-group">
                    <label>Icon:</label>
                    <input type="text" id="category-icon" placeholder="🤖">
                        </div>
                <button type="submit" class="btn btn-primary">💾 Lưu Danh Mục</button>
                    </form>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📦 Thêm/Sửa Sản Phẩm</h3>
                <span class="close" onclick="closeProductModal()">&times;</span>
                    </div>
            <form id="productForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>Tên Sản Phẩm:</label>
                        <input type="text" id="product-name" required>
                </div>
                    <div class="form-group">
                        <label>Danh Mục:</label>
                        <select id="product-category" required>
                            <!-- Categories will be loaded here -->
                        </select>
            </div>
                </div>
                        <div class="form-group">
                    <label>Mô Tả:</label>
                    <textarea id="product-description"></textarea>
                        </div>
                <div class="form-row">
                        <div class="form-group">
                        <label>Giá Bán (₫):</label>
                        <input type="number" id="product-price" required>
                        </div>
                    <div class="form-group">
                        <label>Giá Gốc (₫):</label>
                        <input type="number" id="product-original-price">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Số Lượng:</label>
                        <input type="number" id="product-stock" required>
            </div>
                    <div class="form-group">
                        <label>Trạng Thái:</label>
                        <select id="product-status">
                            <option value="active">Hoạt Động</option>
                            <option value="inactive">Tạm Dừng</option>
                        </select>
        </div>
    </div>
                <div class="form-group">
                    <label>Link Hình Ảnh:</label>
                    <input type="url" id="product-image" placeholder="https://example.com/image.jpg">
            </div>
                <button type="submit" class="btn btn-primary">💾 Lưu Sản Phẩm</button>
            </form>
        </div>
    </div>

    <script>
        let database = {};
        let currentCategoryId = null;
        let currentProductId = null;

        // Load database
        async function loadDatabase() {
            try {
                const response = await fetch('/api/database');
                database = await response.json();
                updateDashboard();
                loadCategories();
                loadProducts();
                    loadOrders();
                loadSettings();
            } catch (error) {
                console.error('Error loading database:', error);
                // Load from local file if API fails
                database = {
                    categories: [],
                    products: [],
                    orders: [],
                    settings: {
                        site_name: "MMO Services Store",
                        site_description: "Cửa hàng dịch vụ MMO uy tín",
                        contact_email: "admin@andev.site",
                        contact_phone: "0123456789"
                    }
                };
            }
        }

        // Update dashboard stats
        function updateDashboard() {
            document.getElementById('total-products').textContent = database.products?.length || 0;
            document.getElementById('total-categories').textContent = database.categories?.length || 0;
            document.getElementById('total-orders').textContent = database.orders?.length || 0;
            
            const totalRevenue = database.orders?.reduce((sum, order) => sum + (order.total || 0), 0) || 0;
            document.getElementById('total-revenue').textContent = new Intl.NumberFormat('vi-VN').format(totalRevenue) + '₫';
        }

        // Show section
        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(el => el.style.display = 'none');
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-menu a').forEach(el => el.classList.remove('active'));
            
            // Show selected section
            document.getElementById(section + '-section').style.display = 'block';
            
            // Add active class to clicked nav item
            event.target.classList.add('active');
        }

        // Load categories
        function loadCategories() {
            const tbody = document.getElementById('categories-table');
            tbody.innerHTML = '';
            
            if (database.categories) {
                database.categories.forEach(category => {
                    const productCount = database.products?.filter(p => p.category_id === category.id).length || 0;
                    tbody.innerHTML += `
                        <tr>
                            <td>${category.id}</td>
                            <td>${category.icon} ${category.name}</td>
                            <td>${category.description}</td>
                            <td>${productCount}</td>
                            <td>
                                <button class="btn btn-warning" onclick="editCategory(${category.id})">✏️</button>
                                <button class="btn btn-danger" onclick="deleteCategory(${category.id})">🗑️</button>
                    </td>
                </tr>
                    `;
                });
            }
        }

        // Load products
        function loadProducts() {
            const tbody = document.getElementById('products-table');
            tbody.innerHTML = '';
            
            if (database.products) {
                database.products.forEach(product => {
                    const category = database.categories?.find(c => c.id === product.category_id);
                    const statusBadge = product.status === 'active' ? 
                        '<span class="badge badge-success">Hoạt Động</span>' : 
                        '<span class="badge badge-danger">Tạm Dừng</span>';
                    
                    tbody.innerHTML += `
                        <tr>
                            <td>${product.id}</td>
                            <td>${product.name}</td>
                            <td>${category?.name || 'N/A'}</td>
                            <td>${new Intl.NumberFormat('vi-VN').format(product.price)}₫</td>
                            <td>${product.stock}</td>
                            <td>${statusBadge}</td>
                            <td>
                                <button class="btn btn-warning" onclick="editProduct(${product.id})">✏️</button>
                                <button class="btn btn-danger" onclick="deleteProduct(${product.id})">🗑️</button>
                            </td>
                        </tr>
                    `;
                });
            }
        }

        // Load orders
        function loadOrders() {
            const tbody = document.getElementById('orders-table');
            tbody.innerHTML = '';
            
            if (database.orders && database.orders.length > 0) {
                database.orders.forEach(order => {
                    const statusBadge = order.status === 'paid' ? 
                        '<span class="badge badge-success">Đã Thanh Toán</span>' : 
                        '<span class="badge badge-warning">Chờ Thanh Toán</span>';
                    
                    tbody.innerHTML += `
                        <tr>
                            <td>${order.id}</td>
                            <td>${order.customer_name || 'N/A'}</td>
                            <td>${order.product_name || 'N/A'}</td>
                            <td>${new Intl.NumberFormat('vi-VN').format(order.total)}₫</td>
                            <td>${statusBadge}</td>
                            <td>${new Date(order.created_at).toLocaleDateString('vi-VN')}</td>
                            <td>
                                <button class="btn btn-primary" onclick="viewOrder('${order.id}')">👁️</button>
                            </td>
                        </tr>
                    `;
                });
                } else {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Chưa có đơn hàng nào</td></tr>';
            }
        }

        // Load settings
        function loadSettings() {
            if (database.settings) {
                document.getElementById('site-name').value = database.settings.site_name || '';
                document.getElementById('site-description').value = database.settings.site_description || '';
                document.getElementById('contact-email').value = database.settings.contact_email || '';
                document.getElementById('contact-phone').value = database.settings.contact_phone || '';
            }
        }

        // Category modal functions
        function openCategoryModal(categoryId = null) {
            currentCategoryId = categoryId;
            const modal = document.getElementById('categoryModal');
            const form = document.getElementById('categoryForm');
            
            if (categoryId) {
                const category = database.categories.find(c => c.id === categoryId);
                if (category) {
                    document.getElementById('category-name').value = category.name;
                    document.getElementById('category-description').value = category.description;
                    document.getElementById('category-icon').value = category.icon;
                }
            } else {
                form.reset();
            }
            
            modal.style.display = 'block';
        }

        function closeCategoryModal() {
            document.getElementById('categoryModal').style.display = 'none';
        }

        // Product modal functions
        function openProductModal(productId = null) {
            currentProductId = productId;
            const modal = document.getElementById('productModal');
            const form = document.getElementById('productForm');
            
            // Load categories for dropdown
            const categorySelect = document.getElementById('product-category');
            categorySelect.innerHTML = '';
            if (database.categories) {
                database.categories.forEach(category => {
                    categorySelect.innerHTML += `<option value="${category.id}">${category.icon} ${category.name}</option>`;
                });
            }
            
            if (productId) {
                const product = database.products.find(p => p.id === productId);
                if (product) {
                    document.getElementById('product-name').value = product.name;
                    document.getElementById('product-description').value = product.description;
                    document.getElementById('product-price').value = product.price;
                    document.getElementById('product-original-price').value = product.original_price || '';
                    document.getElementById('product-stock').value = product.stock;
                    document.getElementById('product-status').value = product.status;
                    document.getElementById('product-category').value = product.category_id;
                    document.getElementById('product-image').value = product.image || '';
                }
            } else {
                form.reset();
            }
            
            modal.style.display = 'block';
        }

        function closeProductModal() {
            document.getElementById('productModal').style.display = 'none';
        }

        // Form submissions
        document.getElementById('categoryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            saveCategory();
        });

        document.getElementById('productForm').addEventListener('submit', function(e) {
            e.preventDefault();
            saveProduct();
        });

        // Save category
        function saveCategory() {
            const name = document.getElementById('category-name').value;
            const description = document.getElementById('category-description').value;
            const icon = document.getElementById('category-icon').value;

            if (currentCategoryId) {
                // Update existing category
                const category = database.categories.find(c => c.id === currentCategoryId);
                if (category) {
                    category.name = name;
                    category.description = description;
                    category.icon = icon;
                }
                } else {
                // Add new category
                const newCategory = {
                    id: Date.now(),
                    name: name,
                    description: description,
                    icon: icon,
                    created_at: new Date().toISOString()
                };
                database.categories.push(newCategory);
            }

            saveDatabase();
            loadCategories();
            closeCategoryModal();
        }

        // Save product
        function saveProduct() {
            const name = document.getElementById('product-name').value;
            const description = document.getElementById('product-description').value;
            const price = parseInt(document.getElementById('product-price').value);
            const originalPrice = parseInt(document.getElementById('product-original-price').value) || price;
            const stock = parseInt(document.getElementById('product-stock').value);
            const status = document.getElementById('product-status').value;
            const categoryId = parseInt(document.getElementById('product-category').value);
            const image = document.getElementById('product-image').value;

            if (currentProductId) {
                // Update existing product
                const product = database.products.find(p => p.id === currentProductId);
                if (product) {
                    product.name = name;
                    product.description = description;
                    product.price = price;
                    product.original_price = originalPrice;
                    product.stock = stock;
                    product.status = status;
                    product.category_id = categoryId;
                    product.image = image;
                }
            } else {
                // Add new product
                const newProduct = {
                    id: Date.now(),
                    category_id: categoryId,
                    name: name,
                    description: description,
                    price: price,
                    original_price: originalPrice,
                    stock: stock,
                    image: image,
                    status: status,
                    created_at: new Date().toISOString()
                };
                database.products.push(newProduct);
            }

            saveDatabase();
            loadProducts();
            closeProductModal();
        }

        // Save settings
        function saveSettings() {
            database.settings = {
                site_name: document.getElementById('site-name').value,
                site_description: document.getElementById('site-description').value,
                contact_email: document.getElementById('contact-email').value,
                contact_phone: document.getElementById('contact-phone').value,
                payment_config: database.settings?.payment_config || {}
            };

            saveDatabase();
            alert('✅ Cài đặt đã được lưu!');
        }

        // Save database
        async function saveDatabase() {
            try {
                await fetch('/api/database', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(database)
                });
            } catch (error) {
                console.error('Error saving database:', error);
            }
        }

        // Edit functions
        function editCategory(id) {
            openCategoryModal(id);
        }

        function editProduct(id) {
            openProductModal(id);
        }

        // Delete functions
        function deleteCategory(id) {
            if (confirm('Bạn có chắc muốn xóa danh mục này?')) {
                database.categories = database.categories.filter(c => c.id !== id);
                saveDatabase();
                loadCategories();
            }
        }

        function deleteProduct(id) {
            if (confirm('Bạn có chắc muốn xóa sản phẩm này?')) {
                database.products = database.products.filter(p => p.id !== id);
                saveDatabase();
                loadProducts();
            }
        }

        // View order
        function viewOrder(id) {
            const order = database.orders.find(o => o.id === id);
            if (order) {
                alert(`Đơn hàng: ${order.id}\nKhách hàng: ${order.customer_name}\nSản phẩm: ${order.product_name}\nTổng tiền: ${new Intl.NumberFormat('vi-VN').format(order.total)}₫\nTrạng thái: ${order.status}`);
            }
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const categoryModal = document.getElementById('categoryModal');
            const productModal = document.getElementById('productModal');
            
            if (event.target === categoryModal) {
                closeCategoryModal();
            }
            if (event.target === productModal) {
                closeProductModal();
            }
        }

        // Initialize
        window.addEventListener('load', loadDatabase);
    </script>
</body>
</html>